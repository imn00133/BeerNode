{% extends 'base.html' %}
{% load static %}

{% block content %}


<link rel="stylesheet" href="{% static 'css/detail.css' %}">
<div class=main_content>
    <div class=pic_taste>
        <div id=picture>
            <img src="{{ target_beer.picture.url }}" alt="맥주 사진" id="profile">
        </div>
            <p style="font-size: 1.5rem;">평점</p>
            {% if target_beer.rating %}
            <div class='star-rating'>
                    <span id="star_blue"></span>
            </div>
            <script>
                var ratingPercent = 20 * {{ target_beer.rating }};
                document.getElementById('star_blue').style.width = ratingPercent + '%';
            </script>
                <br>
                {{ target_beer.rating }} / 5.0
            {% else %}
                <h5>
                    평점이 없습니다
                </h5>
            {% endif %}
        <div id=taste>
            <p style="font-size: 1.5rem;">맛</p>
            <div style="float:left;">
                <ul>
                <li>sweet :
                    {% if target_beer.sweet %}
                        {{ target_beer.sweet }} / 5.0
                    {% else %}
                        값이 없습니다
                    {% endif %}
                </li>
                <li>sour :
                    {% if target_beer.sour %}
                        {{ target_beer.sour }} / 5.0
                    {% else %}
                        값이 없습니다
                    {% endif %}
                </li>
                <li>bitter :
                    {% if target_beer.bitter %}
                        {{ target_beer.bitter }} / 5.0
                    {% else %}
                        값이 없습니다
                    {% endif %}
                </li>
                <li>hoppy :
                    {% if target_beer.hoppy %}
                        {{ target_beer.hoppy }} / 5.0
                    {% else %}
                        값이 없습니다
                    {% endif %}
                </li>
                <li>fruity :
                    {% if target_beer.fruity %}
                        {{ target_beer.fruity }} / 5.0
                    {% else %}
                        값이 없습니다
                    {% endif %}
                </li>
                <li>malty :
                    {% if target_beer.malty %}
                        {{ target_beer.malty }} / 5.0
                    {% else %}
                        값이 없습니다
                    {% endif %}
                </li>
            </ul>
            </div>
            <div>
                <canvas id="myCanvas" width="200" height="200"></canvas>
            </div>
        </div>
    </div>
    <div class=content>
        <div style="display:flex; flex-direction: row">
            <div  style="flex:1;display:flex;flex-direction:column">
                <div id=title style="flex:1">
                    <p>{{ target_beer.beer_name }}</p>
                    <p>작성자: {{ target_beer.writer }}</p>
                </div>
            </div>
            <div>
                <div id=location style="flex:1">
                    <p>마신 장소: {{ target_beer.place }}</p>
                </div>
                <div style="position:relative;z-index:1">
                    {% if target_beer.lat %}
                        {% include 'scrapapp/detail_map.html' with target_beer=target_beer %}
                    {% else %}
                        장소가 없습니다
                    {% endif %}
                </div>
            </div>
        </div>
        <div id=text>
            <p>{{ target_beer.context }}</p>
        </div>
    </div>
</div>
<div style="float:left;">

</div>

{% if user == target_beer.writer %}
    <a href="{% url 'scrapapp:update' pk=target_beer.pk %}">
        수정
    </a>
    <a href="{% url 'scrapapp:delete' pk=target_beer.pk %}">
        삭제
    </a>
{% endif %}

<script>
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
    var centerX = canvas.width / 2;
    var centerY = canvas.height / 2;
    var radius = 85;
    var copy = 6;

    var hex_width = 2;
    var hex_color = '#8f8580';
    var radius_width = 1;
    var radius_color = '#414141';
    var data_width = 4;
    var data_color = '#ba9800';
    var data_fillcolor = '#f0c400';
    var text_color = '#000000';

    var data_sample = [{{ target_beer.sweet }}, {{ target_beer.sour }}, {{ target_beer.bitter }},
                       {{ target_beer.hoppy }}, {{ target_beer.fruity }}, {{ target_beer.malty }}];
    var max_rate = 5;
    console.log(data_sample);

    function hex(context, centerX, centerY, radius, shape){
        var hexPos=[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]];
        for(var i = 0; i < hexPos.length; i++){
            hexPos[i] = [centerX + radius * Math.cos(Math.PI * i / 3),
                         centerY + radius * Math.sin(Math.PI * i / 3)];
        }
        if(shape === 0){
            context.beginPath();
            context.moveTo(centerX+radius, centerY);
            for(i = 0; i < hexPos.length; i++){
                var pos = hexPos[i];
                context.lineTo(pos[0], pos[1]);
            }
            context.lineTo(hexPos[0][0], hexPos[0][1]);
            context.lineWidth = hex_width;
            context.strokeStyle = hex_color;
            context.lineCap = 'round';
            context.lineJoin ='round';
            context.stroke();
        }
        if(shape === 1){
            context.beginPath();
            for(i = 0; i<hexPos.length; i++){
                var pos = hexPos[i];
                context.moveTo(centerX, centerY);
                context.lineTo(pos[0], pos[1]);
            }
            context.lineWidth = radius_width;
            context.strokeStyle = radius_color;
            context.lineCap = 'round';
            context.lineJoin = 'round';
            context.stroke();
        }

    }

    function layered_hex(context, centerX, centerY, radius, copy){
        hex(context, centerX, centerY, radius, 1);
        hex(context,centerX, centerY, 1, 0);
        for(var i = 1; i < copy; i++){
            hex(context, centerX, centerY, radius / (copy-1) * i, 0);
        }
    }

    function data_hex(context, centerX, centerY, radius, dataset, fill){
        var convert_data = [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]];
        for(i = 0; i < dataset.length; i++){
            radius_convert = radius * dataset[i] / max_rate;
            convert_data[i] = [centerX + radius_convert * Math.cos(Math.PI * i / 3),
                               centerY + radius_convert * Math.sin(Math.PI * i / 3)];
        }

        context.beginPath();
        context.moveTo(centerX+radius, centerY);
        for(i = 0; i < convert_data.length; i++){
            var pos = convert_data[i];
            context.lineTo(pos[0], pos[1]);
        }
        context.lineTo(centerX + radius, centerY);
        context.lineWidth = data_width;
        context.strokeStyle = data_color;
        context.lineCap = 'round';
        context.lineJoin ='round';
        if( fill === 1){
            context.fillStyle = data_fillcolor;
            context.fill();
        }
        context.stroke();
    }

    data_hex(context, centerX, centerY, radius, data_sample, 1);
    layered_hex(context, centerX, centerY, radius, copy);
    data_hex(context, centerX, centerY, radius, data_sample, 0);

    var hexPos = [0,0,0,0,0,0];
    for(var i = 0; i < hexPos.length; i++){
            hexPos[i] = [centerX + (radius + 10) * Math.cos(Math.PI * i / 3),
                         centerY + (radius + 10) * Math.sin(Math.PI * i / 3)];
    }
    console.log('hexPos :');
    console.log(hexPos);
    context.font = '10px malgun gothic';
    context.fillStyle = text_color;
    context.fillText('단맛', hexPos[0][0]-10, hexPos[0][1]);
    context.fillText('신맛', hexPos[1][0]-10, hexPos[1][1]);
    context.fillText('쓴맛', hexPos[2][0]-10, hexPos[2][1]);
    context.fillText('홉향', hexPos[3][0], hexPos[3][1]);
    context.fillText('과일향', hexPos[4][0]-10, hexPos[4][1]);
    context.fillText('맥아향', hexPos[5][0]-10, hexPos[5][1]);
</script>

{% endblock %}
